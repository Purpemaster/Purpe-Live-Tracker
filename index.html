<!-- Solana PYUSD BALANCE FETCH + TOAST -->
<script>
  const SOLANA_WALLET = "2b1kV6DkPAnxd5ixfnxCpjxmKwqjjaYmCZfHsFu24GXo";
  const PYUSD_MINT = "2b1kV6DkPAnxd5ixfnxCpjxmKwqjjaYmCZfHsFu24GXo"; // KORREKT
  const HELIUS_API_KEY = "2e046356-0f0c-4880-93cc-6d5467e81c73";

  let lastPYUSDBalance = null;

  async function fetchSolanaPYUSDBalance() {
    const url = `https://api.helius.xyz/v0/addresses/${SOLANA_WALLET}/balances?api-key=${HELIUS_API_KEY}`;

    try {
      const res = await fetch(url);
      const data = await res.json();

      const token = data.tokens.find(t => t.mint === PYUSD_MINT);
      const balance = token ? token.amount : 0;

      // Debug-Ausgabe zur Sicherheit
      console.log("Gefundene PYUSD-Balance:", balance);

      if (lastPYUSDBalance !== null && balance > lastPYUSDBalance) {
        const diff = (balance - lastPYUSDBalance).toFixed(2);
        showToast(`+ $${diff} PYUSD received!`);
      }

      lastPYUSDBalance = balance;

      // Ãœbergabe an das Spenden-Objekt
      if (typeof donations !== "undefined") {
        donations.PYUSD = balance;
        if (typeof updateDisplay === "function") updateDisplay();
      }

    } catch (err) {
      console.error("PYUSD Fetch Error:", err);
    }
  }

  function showToast(message) {
    const toast = document.createElement("div");
    toast.textContent = message;
    toast.style.position = "fixed";
    toast.style.bottom = "20px";
    toast.style.right = "20px";
    toast.style.background = "rgba(0,0,0,0.85)";
    toast.style.color = "#fff";
    toast.style.padding = "10px 20px";
    toast.style.borderRadius = "8px";
    toast.style.fontFamily = "'Orbitron', sans-serif";
    toast.style.boxShadow = "0 0 15px purple";
    toast.style.zIndex = "9999";
    document.body.appendChild(toast);

    setTimeout(() => {
      toast.style.transition = "opacity 1s ease";
      toast.style.opacity = 0;
      setTimeout(() => toast.remove(), 1000);
    }, 3000);
  }

  // Start direkt und dann alle 60 Sekunden
  fetchSolanaPYUSDBalance();
  setInterval(fetchSolanaPYUSDBalance, 60000);
</script>
